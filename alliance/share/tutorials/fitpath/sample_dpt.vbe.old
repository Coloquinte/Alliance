

-- ###---------------------------------------------------------------------###
-- #                                                                         #
-- #          Alliance CAD System V.R                                        #
-- #             FpGen Package V.RR                                          #
-- #                                                                         #
-- #  Copyright(c) 93-AA, MASI, CAO-VLSI Team                                #
-- #                                                                         #
-- #  Author      :          Jean-Paul CHAPUT                                #
-- #  E-mail      :      cao-vlsi@masi.ibp.fr                                #
-- # ======================================================================= #
-- #  File        :      "sample_dpt.vbe"                                    #
-- # *********************************************************************** #
-- #  Data-Path sample example.                                              #
-- #                                                                         #
-- ###---------------------------------------------------------------------###


ENTITY  sample_dpt  IS
  PORT(
      -- Control terminals declarations.
      ctrl_sel   : in    BIT;
      ctrl_ck    : in    BIT;
      ctrl_wen   : in    BIT;
      ctrl_ncout :   out BIT;
      ctrl_nover :   out BIT;
      ctrl_zero  :   out BIT;

      -- Data terminals declarations.
      data_a : in    BIT_VECTOR(7 downto 0);
      data_b : in    BIT_VECTOR(7 downto 0);
      data_s : inout BIT_VECTOR(7 downto 0);

      -- Power supplies terminals.
      vdd : in    BIT;
      vss : in    BIT
      );
END  sample_dpt;


ARCHITECTURE  behavior_data_flow  OF  sample_dpt  IS

	SIGNAL wmd      : BIT;
	SIGNAL ws       : BIT;

	SIGNAL memory_m : REG_VECTOR(7 downto 0) REGISTER;
	SIGNAL memory_s : REG_VECTOR(7 downto 0) REGISTER;

	SIGNAL cry      : BIT_VECTOR(8 downto 0);
	SIGNAL dwen     : BIT_VECTOR(7 downto 0);
	SIGNAL data_m   : BIT_VECTOR(7 downto 0);
	SIGNAL data_q   : BIT_VECTOR(7 downto 0);

BEGIN
  -- Multiplexer (related to DP_MUX2CS).
  WITH  ctrl_sel  SELECT
    data_m <= data_b  WHEN '1',
              data_q  WHEN '0';


  -- Fast Adder (related to ADD2F).
  cry(0) <= '0';
  cry(8 downto 1) <=    (data_m and data_a)
                     or (data_m and cry(7 downto 0))
                     or (data_a and cry(7 downto 0));

  data_s     <= data_m xor data_a xor cry(7 downto 0);
  ctrl_nover <= not cry(7);
  ctrl_ncout <= not cry(8);


  -- Zero Detect (related to DP_NUL).
  WITH  data_s  SELECT
    ctrl_zero <= '1' WHEN  B"00000000",
                 '0' WHEN  OTHERS;


  -- Register (related to DP_PDFF).
  wmd <=   not (not (ctrl_ck) or not (ctrl_wen))  ;
  ws  <= not ctrl_ck;

  WITH ctrl_wen SELECT
    dwen <= data_s WHEN '1',
            data_q WHEN '0'; 

  wmd:BLOCK( wmd ) BEGIN memory_m <= GUARDED not data_s; END BLOCK wmd;
  ws :BLOCK( ws  ) BEGIN memory_s <= GUARDED memory_m; END BLOCK ws;

  data_q <= not memory_s;


  ASSERT((vdd = '1') and (vss = '0'))
    REPORT "Power supply is missing on sample_dpt"
    SEVERITY WARNING;
END  behavior_data_flow;
