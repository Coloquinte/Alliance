;  ###----------------------------------------------------------------###
;  #									#
;  # file	: trp000.u						#
;  # date	: Apr  1 1993						#
;  # descr.	: functional test for dlx				#
;  #									#
;  ###----------------------------------------------------------------###

	;  ###--------------------------------------------------------###
	;  #   software interrupt :					#
	;  ###--------------------------------------------------------###

trap_nbr	equ	X"32f0ba"		; trap number

		org	X"7fffff00"
		start	init

init:
		loadi	r31, back_from_exception
		loadi	r1 , trap_nbr ^ X"ffffffff"
		loadi	r2 , trap_nbr

	;  ###--------------------------------------------------------###
	;  #  sotware interrupt						#
	;  ###--------------------------------------------------------###

		trap	trap_nbr
		j	bad
		nop

	;  ###--------------------------------------------------------###
	;  #   check that the the trap has been done (r1 must contain	#
	;  # the trap number)						#
	;  ###--------------------------------------------------------###

back_from_exception:
		seq	r4 , r2 , r1		; check that the lw has failed
		bnez	r4 , good		; jump to good if OK
		nop
		j	bad
		nop

		org	X"7ffffff0"
good		j	good
		nop
bad		j	bad
		nop

		end
